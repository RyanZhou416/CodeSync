# Project: CodeSync
## Structure

â”œâ”€ [x] .github
â”‚  â””â”€ [x] workflows
â”‚     â””â”€ [x] release.yml
â”œâ”€ [ ] assets
â”‚  â”œâ”€ [ ] icon.icns
â”‚  â”œâ”€ [ ] icon.svg
â”‚  â””â”€ [ ] lang.json
â”œâ”€ [x] build_scripts
â”‚  â”œâ”€ [x] ChineseSimplified.isl
â”‚  â”œâ”€ [x] linux_build.sh
â”‚  â”œâ”€ [x] mac_build.sh
â”‚  â”œâ”€ [x] win_build.bat
â”‚  â””â”€ [x] win_setup.iss
â”œâ”€ [x] server
â”‚  â”œâ”€ [x] docker-compose.yml
â”‚  â”œâ”€ [x] Dockerfile
â”‚  â””â”€ [x] server.py
â”œâ”€ [x] src
â”‚  â”œâ”€ [x] __init__.py
â”‚  â”œâ”€ [x] config.py
â”‚  â”œâ”€ [x] gui.py
â”‚  â”œâ”€ [x] logic.py
â”‚  â”œâ”€ [x] main.py
â”‚  â””â”€ [x] utils.py
â”œâ”€ [x] .gitignore
â”œâ”€ [ ] LICENSE
â”œâ”€ [ ] README.md
â”œâ”€ [ ] README_CN.md
â”œâ”€ [x] requirements.txt
â”œâ”€ [x] VERSION
â””â”€ [ ] ç»“æœ.txt

========================================
## Contents


--- START: .github/workflows/release.yml ---

name: Publish Release

on:
  push:
    branches: [ "master" ]
    paths: [ "VERSION" ]
    tags: [ "v*" ]
  workflow_dispatch:

permissions:
  contents: write
  packages: write

jobs:
  # ===================================================
  # 1. å‡†å¤‡å·¥ä½œ
  # ===================================================
  prepare:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.get_version.outputs.version }}
    steps:
      - uses: actions/checkout@v4
      - name: Read VERSION file
        id: get_version
        run: |
          v=$(cat VERSION | xargs)
          if [[ $v != v* ]]; then v="v$v"; fi
          echo "version=$v" >> $GITHUB_OUTPUT
          echo "Target Version: $v"

  # ===================================================
  # 2. Windows æ„å»º
  # ===================================================
  build-windows:
    needs: prepare
    runs-on: windows-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - arch: x64
            py_arch: 'x64'
          - arch: x86
            py_arch: 'x86'
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
          architecture: ${{ matrix.py_arch }}
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pyinstaller
      - name: Install Inno Setup
        run: choco install innosetup
      - name: Build EXE
        run: |
          pyinstaller --noconsole --onefile --name "CodeSync" --paths "src" --add-data "assets/lang.json;assets" --add-data "VERSION;." src/main.py
      - name: Compile Installer
        shell: cmd
        # Windows å·²ç»åœ¨ .iss æ–‡ä»¶å†…éƒ¨å¤„ç†äº†ç‰ˆæœ¬å·æ‹¼æ¥ï¼Œè¿™é‡Œåªéœ€ä¼ å…¥å˜é‡
        run: |
          "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" /DMyOutputFilename="CodeSync_Setup_Win_${{ matrix.arch }}" /DMyAppArch="${{ matrix.arch }}" build_scripts\win_setup.iss
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: setup-windows-${{ matrix.arch }}
          path: Output/*.exe

  # ===================================================
  # 3. macOS æ„å»º
  # ===================================================
  build-macos:
    needs: prepare
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: |
          brew install create-dmg
          pip install -r requirements.txt
          pip install pyinstaller

      - name: Build .app
        run: |
          pyinstaller --noconsole --windowed --name "CodeSync" --paths "src" --add-data "assets/lang.json:assets" --add-data "VERSION:." src/main.py

      - name: Create DMG
        # æ ¸å¿ƒä¿®æ”¹ï¼šåœ¨æ–‡ä»¶åä¸­åŠ å…¥ç‰ˆæœ¬å·å˜é‡
        run: |
          VERSION="${{ needs.prepare.outputs.version }}"
          DMG_NAME="CodeSync_Mac_${VERSION}_Universal.dmg"

          create-dmg \
            --volname "CodeSync Installer" \
            --window-pos 200 120 \
            --window-size 800 400 \
            --app-drop-link 600 185 \
            "$DMG_NAME" \
            "dist/CodeSync.app"

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: dmg-macos-universal
          path: "*.dmg"

  # ===================================================
  # 4. Linux æ„å»º
  # ===================================================
  build-linux:
    needs: prepare
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pyinstaller
      - name: Build Binary
        run: |
          pyinstaller --noconsole --onefile --name "CodeSync" --paths "src" --add-data "assets/lang.json:assets" --add-data "VERSION:." src/main.py

          # æ ¸å¿ƒä¿®æ”¹ï¼šé‡å‘½åäºŒè¿›åˆ¶æ–‡ä»¶å¸¦ç‰ˆæœ¬å·
          VERSION="${{ needs.prepare.outputs.version }}"
          mv dist/CodeSync "CodeSync_Linux_${VERSION}_amd64.bin"

      - name: Create .deb package
        run: |
          VER=$(cat VERSION | xargs)
          FULL_VER="${{ needs.prepare.outputs.version }}"

          mkdir -p deb_package/usr/local/bin
          mkdir -p deb_package/DEBIAN

          # å¤åˆ¶åˆšæ‰é‡å‘½åè¿‡çš„ bin æ–‡ä»¶å¹¶æ”¹å›é€šç”¨å codesyncï¼Œæ–¹ä¾¿ç”¨æˆ·è¾“å…¥å‘½ä»¤
          cp "CodeSync_Linux_${FULL_VER}_amd64.bin" deb_package/usr/local/bin/codesync
          chmod +x deb_package/usr/local/bin/codesync

          echo "Package: codesync" > deb_package/DEBIAN/control
          echo "Version: $VER" >> deb_package/DEBIAN/control
          echo "Architecture: amd64" >> deb_package/DEBIAN/control
          echo "Maintainer: Ryan" >> deb_package/DEBIAN/control
          echo "Description: CodeSync Client" >> deb_package/DEBIAN/control

          # æ ¸å¿ƒä¿®æ”¹ï¼šè¾“å‡º deb æ–‡ä»¶åå¸¦ç‰ˆæœ¬å·
          dpkg-deb --build deb_package "CodeSync_Linux_${FULL_VER}_amd64.deb"

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: linux-packages
          path: |
            *.bin
            *.deb

  # ===================================================
  # 5. Server Docker æ„å»º
  # ===================================================
  build-docker:
    needs: prepare
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Log in to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: Extract metadata
        id: meta
        uses: docker/metadata-action@v5
        with:
          images: ghcr.io/${{ github.repository }}/codesync-server
          tags: |
            type=raw,value=latest
            type=raw,value=${{ needs.prepare.outputs.version }}
      - name: Build and push
        uses: docker/build-push-action@v5
        with:
          context: ./server
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}

  # ===================================================
  # 6. å‘å¸ƒ Release
  # ===================================================
  release:
    needs: [prepare, build-windows, build-macos, build-linux, build-docker]
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Download Windows Artifacts
        uses: actions/download-artifact@v4
        with:
          pattern: setup-windows-*
          merge-multiple: true
      - name: Download macOS Artifacts
        uses: actions/download-artifact@v4
        with:
          pattern: dmg-macos-*
          merge-multiple: true
      - name: Download Linux Artifacts
        uses: actions/download-artifact@v4
        with:
          name: linux-packages

      - name: Publish to GitHub Releases
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ needs.prepare.outputs.version }}
          name: Release ${{ needs.prepare.outputs.version }}
          draft: false
          prerelease: false
          files: |
            *.exe
            *.dmg
            *.bin
            *.deb
          generate_release_notes: true

--- END: .github/workflows/release.yml ---


--- START: build_scripts/ChineseSimplified.isl ---

; *** Inno Setup version 6.0.0+ Chinese Simplified messages ***
;
[LangOptions]
LanguageName=Chinese Simplified
LanguageID=$0804
LanguageCodePage=936
; If the language is not displayed correctly in the installer, try changing the
; following font settings.
DialogFontName=å®‹ä½“
DialogFontSize=9
WelcomeFontName=å®‹ä½“
WelcomeFontSize=12
TitleFontName=å®‹ä½“
TitleFontSize=29
CopyrightFontName=Arial
CopyrightFontSize=8

[Messages]

; *** Application titles
SetupAppTitle=å®‰è£…
SetupWindowTitle=å®‰è£… - %1
UninstallAppTitle=å¸è½½
UninstallAppFullTitle=%1 å¸è½½

; *** Misc. common
InformationTitle=ä¿¡æ¯
ConfirmTitle=ç¡®è®¤
ErrorTitle=é”™è¯¯

; *** SetupLdr messages
SetupLdrStartupMessage=è¿™å°†å®‰è£… %1ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ
LdrCannotCreateTemp=ä¸èƒ½åˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚å®‰è£…ä¸­æ­¢
LdrCannotExecTemp=ä¸èƒ½åœ¨ä¸´æ—¶ç›®å½•ä¸­æ‰§è¡Œæ–‡ä»¶ã€‚å®‰è£…ä¸­æ­¢

; *** Startup error messages
LastErrorMessage=%1.%n%né”™è¯¯ %2: %3
SetupFileMissing=åœ¨å®‰è£…ç›®å½•ä¸­æ‰¾ä¸åˆ°æ–‡ä»¶ %1ã€‚è¯·æ›´æ­£è¿™ä¸ªé—®é¢˜æˆ–è·å–ä¸€ä¸ªæ–°çš„æ–‡ä»¶å‰¯æœ¬ã€‚
SetupFileCorrupt=æ–‡ä»¶å·²æŸåã€‚è¯·è·å–ä¸€ä¸ªæ–°çš„æ–‡ä»¶å‰¯æœ¬ã€‚
SetupFileCorruptOrWrongVer=æ–‡ä»¶å·²æŸåï¼Œæˆ–æ˜¯ä¸è¿™ä¸ªç‰ˆæœ¬çš„å®‰è£…ç¨‹åºä¸å…¼å®¹ã€‚è¯·æ›´æ­£è¿™ä¸ªé—®é¢˜æˆ–è·å–ä¸€ä¸ªæ–°çš„æ–‡ä»¶å‰¯æœ¬ã€‚
InvalidParameter=æ— æ•ˆçš„å‘½ä»¤è¡Œå‚æ•°: %n%n%1
SetupAlreadyRunning=å®‰è£…ç¨‹åºæ­£åœ¨è¿è¡Œã€‚
WindowsVersionNotSupported=è¿™ä¸ªç¨‹åºä¸æ”¯æŒä½ çš„è®¡ç®—æœºè¿è¡Œçš„ Windows ç‰ˆæœ¬ã€‚
WindowsServicePackRequired=è¿™ä¸ªç¨‹åºè¦æ±‚ %1 Service Pack %2 æˆ–æ›´é«˜ã€‚
NotOnThisPlatform=è¿™ä¸ªç¨‹åºå°†ä¸èƒ½åœ¨ %1 ä¸Šè¿è¡Œã€‚
OnlyOnThisPlatform=è¿™ä¸ªç¨‹åºå¿…é¡»åœ¨ %1 ä¸Šè¿è¡Œã€‚
OnlyOnTheseArchitectures=è¿™ä¸ªç¨‹åºåªèƒ½åœ¨ä»¥ä¸‹å¤„ç†å™¨æ¶æ„çš„ Windows ç‰ˆæœ¬ä¸­å®‰è£…:%n%n%1
WinVersionTooLowError=è¿™ä¸ªç¨‹åºè¦æ±‚ %1 ç‰ˆæœ¬ %2 æˆ–æ›´é«˜ã€‚
WinVersionTooHighError=è¿™ä¸ªç¨‹åºä¸èƒ½åœ¨ %1 ç‰ˆæœ¬ %2 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­å®‰è£…ã€‚
AdminPrivilegesRequired=åœ¨å®‰è£…è¿™ä¸ªç¨‹åºæ—¶ä½ éœ€è¦ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•ã€‚
PowerUserPrivilegesRequired=åœ¨å®‰è£…è¿™ä¸ªç¨‹åºæ—¶ä½ éœ€è¦ä»¥ç®¡ç†å‘˜èº«ä»½æˆ–æœ‰æƒé™çš„ç”¨æˆ·èº«ä»½ç™»å½•ã€‚
SetupAppRunningError=å®‰è£…ç¨‹åºæ£€æµ‹åˆ° %1 å½“å‰æ­£åœ¨è¿è¡Œã€‚%n%nè¯·ç°åœ¨å…³é—­å®ƒçš„æ‰€æœ‰å®ä¾‹ï¼Œç„¶åå•å‡»â€œç¡®å®šâ€ç»§ç»­ï¼Œæˆ–â€œå–æ¶ˆâ€é€€å‡ºã€‚
UninstallAppRunningError=å¸è½½ç¨‹åºæ£€æµ‹åˆ° %1 å½“å‰æ­£åœ¨è¿è¡Œã€‚%n%nè¯·ç°åœ¨å…³é—­å®ƒçš„æ‰€æœ‰å®ä¾‹ï¼Œç„¶åå•å‡»â€œç¡®å®šâ€ç»§ç»­ï¼Œæˆ–â€œå–æ¶ˆâ€é€€å‡ºã€‚

; *** Startup questions
PrivilegesRequiredOverrideTitle=é€‰æ‹©å®‰è£…æ¨¡å¼
PrivilegesRequiredOverrideInstruction=é€‰æ‹©å®‰è£…æ¨¡å¼
PrivilegesRequiredOverrideText1=%1 å¯ä»¥ä¸ºæ‰€æœ‰ç”¨æˆ·å®‰è£… (éœ€è¦ç®¡ç†å‘˜æƒé™)ï¼Œæˆ–ä»…ä¸ºä½ å®‰è£…ã€‚
PrivilegesRequiredOverrideText2=%1 åªèƒ½ä¸ºä½ å®‰è£…ï¼Œæˆ–ä¸ºæ‰€æœ‰ç”¨æˆ·å®‰è£… (éœ€è¦ç®¡ç†å‘˜æƒé™)ã€‚
PrivilegesRequiredOverrideAllUsers=ä¸ºæ‰€æœ‰ç”¨æˆ·å®‰è£…(&A)
PrivilegesRequiredOverrideAllUsersRecommended=ä¸ºæ‰€æœ‰ç”¨æˆ·å®‰è£… (&A) (æ¨è)
PrivilegesRequiredOverrideCurrentUser=ä»…ä¸ºæˆ‘å®‰è£…(&M)
PrivilegesRequiredOverrideCurrentUserRecommended=ä»…ä¸ºæˆ‘å®‰è£… (&M) (æ¨è)

; *** Misc. errors
ErrorCreatingDir=å®‰è£…ç¨‹åºä¸èƒ½åˆ›å»ºç›®å½• "%1"
ErrorTooManyFilesInDir=ä¸èƒ½åœ¨ç›®å½• "%1" ä¸­åˆ›å»ºæ–‡ä»¶ï¼Œå› ä¸ºé‡Œé¢çš„æ–‡ä»¶å¤ªå¤š

; *** Setup common messages
ExitSetupTitle=é€€å‡ºå®‰è£…
ExitSetupMessage=å®‰è£…æœªå®Œæˆã€‚å¦‚æœä½ ç°åœ¨é€€å‡ºï¼Œç¨‹åºå°†ä¸ä¼šè¢«å®‰è£…ã€‚%n%nä½ å¯ä»¥ä»¥åå†è¿è¡Œå®‰è£…ç¨‹åºå®Œæˆå®‰è£…ã€‚%n%né€€å‡ºå®‰è£…å—ï¼Ÿ
AboutSetupMenuItem=å…³äºå®‰è£…ç¨‹åº(&A)...
AboutSetupTitle=å…³äºå®‰è£…ç¨‹åº
AboutSetupMessage=%1 ç‰ˆæœ¬ %2%n%3%n%n%1 ä¸»é¡µ:%n%4
AboutSetupNote=
TranslatorNote=

; *** Buttons
ButtonBack=< ä¸Šä¸€æ­¥(&B)
ButtonNext=ä¸‹ä¸€æ­¥(&N) >
ButtonInstall=å®‰è£…(&I)
ButtonOK=ç¡®å®š
ButtonCancel=å–æ¶ˆ
ButtonYes=æ˜¯(&Y)
ButtonYesToAll=å…¨æ˜¯(&A)
ButtonNo=å¦(&N)
ButtonNoToAll=å…¨å¦(&O)
ButtonFinish=å®Œæˆ(&F)
ButtonBrowse=æµè§ˆ(&B)...
ButtonWizardBrowse=æµè§ˆ(&R)...
ButtonNewFolder=æ–°å»ºæ–‡ä»¶å¤¹(&M)

; *** "Select Language" dialog messages
SelectLanguageTitle=é€‰æ‹©å®‰è£…è¯­è¨€
SelectLanguageLabel=é€‰æ‹©å®‰è£…æ—¶è¦ä½¿ç”¨çš„è¯­è¨€ã€‚

; *** Common wizard text
ClickNext=å•å‡»â€œä¸‹ä¸€æ­¥â€ç»§ç»­ï¼Œæˆ–å•å‡»â€œå–æ¶ˆâ€é€€å‡ºå®‰è£…ç¨‹åºã€‚
BeveledLabel=
BrowseDialogTitle=æµè§ˆæ–‡ä»¶å¤¹
BrowseDialogLabel=åœ¨ä¸‹é¢çš„åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åå•å‡»â€œç¡®å®šâ€ã€‚
NewFolderName=æ–°æ–‡ä»¶å¤¹

; *** "Welcome" wizard page
WelcomeLabel1=æ¬¢è¿ä½¿ç”¨ [name] å®‰è£…å‘å¯¼
WelcomeLabel2=è¿™ä¸ªå‘å¯¼å°†æŒ‡å¼•ä½ å®Œæˆ [name/ver] çš„å®‰è£…ã€‚%n%nåœ¨å¼€å§‹å®‰è£…ä¹‹å‰ï¼Œå»ºè®®å…ˆå…³é—­å…¶ä»–æ‰€æœ‰åº”ç”¨ç¨‹åºã€‚è¿™å°†å…è®¸â€œå®‰è£…ç¨‹åºâ€æ›´æ–°æŒ‡å®šçš„ç³»ç»Ÿæ–‡ä»¶ï¼Œè€Œä¸éœ€è¦é‡æ–°å¯åŠ¨ä½ çš„è®¡ç®—æœºã€‚


; *** "Password" wizard page
WizardPassword=å¯†ç 
PasswordLabel1=è¿™ä¸ªå®‰è£…ç¨‹åºå—å¯†ç ä¿æŠ¤ã€‚
PasswordLabel3=è¯·è¾“å…¥å¯†ç ï¼Œå¯†ç åŒºåˆ†å¤§å°å†™ã€‚ç„¶åå•å‡»â€œä¸‹ä¸€æ­¥â€ç»§ç»­ã€‚
PasswordEditLabel=å¯†ç (&P):
IncorrectPassword=ä½ è¾“å…¥çš„å¯†ç ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•ã€‚

; *** "License Agreement" wizard page
WizardLicense=è®¸å¯åè®®
LicenseLabel1=åœ¨ç»§ç»­å®‰è£…ä¹‹å‰ï¼Œè¯·é˜…è¯»ä¸‹åˆ—é‡è¦ä¿¡æ¯ã€‚
LicenseLabel3=è¯·é˜…è¯»ä¸‹åˆ—è®¸å¯åè®®ã€‚åœ¨ç»§ç»­å®‰è£…ä¹‹å‰ï¼Œä½ å¿…é¡»æ¥å—æ­¤åè®®çš„æ¡æ¬¾ã€‚
LicenseAccepted=æˆ‘æ¥å—åè®®(&A)
LicenseNotAccepted=æˆ‘ä¸æ¥å—åè®®(&I)

; *** "Information" wizard pages
WizardInfoBefore=ä¿¡æ¯
InfoBeforeLabel=åœ¨ç»§ç»­å®‰è£…ä¹‹å‰ï¼Œè¯·é˜…è¯»ä¸‹åˆ—é‡è¦ä¿¡æ¯ã€‚
InfoBeforeClickLabel=å‡†å¤‡å¥½ç»§ç»­å®‰è£…åï¼Œå•å‡»â€œä¸‹ä¸€æ­¥â€ã€‚
WizardInfoAfter=ä¿¡æ¯
InfoAfterLabel=åœ¨ç»§ç»­å®‰è£…ä¹‹å‰ï¼Œè¯·é˜…è¯»ä¸‹åˆ—é‡è¦ä¿¡æ¯ã€‚
InfoAfterClickLabel=å‡†å¤‡å¥½ç»§ç»­å®‰è£…åï¼Œå•å‡»â€œä¸‹ä¸€æ­¥â€ã€‚

; *** "User Information" wizard page
WizardUserInfo=ç”¨æˆ·ä¿¡æ¯
UserInfoDesc=è¯·è¾“å…¥ä½ çš„ä¿¡æ¯ã€‚
UserInfoName=ç”¨æˆ·å(&U):
UserInfoOrg=ç»„ç»‡(&O):
UserInfoSerial=åºåˆ—å·(&S):
UserInfoNameRequired=ä½ å¿…é¡»è¾“å…¥ä¸€ä¸ªåç§°ã€‚

; *** "Select Destination Location" wizard page
WizardSelectDir=é€‰æ‹©ç›®æ ‡ä½ç½®
SelectDirDesc=ä½ å°†æŠŠ [name] å®‰è£…åœ¨å“ªé‡Œï¼Ÿ
SelectDirLabel3=å®‰è£…ç¨‹åºå°†æŠŠ [name] å®‰è£…åœ¨ä¸‹åˆ—æ–‡ä»¶å¤¹ä¸­ã€‚
SelectDirBrowseLabel=è‹¥è¦ç»§ç»­ï¼Œå•å‡»â€œä¸‹ä¸€æ­¥â€ã€‚å¦‚æœä½ æƒ³é€‰æ‹©å…¶å®ƒæ–‡ä»¶å¤¹ï¼Œå•å‡»â€œæµè§ˆâ€ã€‚
DiskSpaceMBLabel=è‡³å°‘éœ€è¦æœ‰ [mb] MB çš„å¯ç”¨ç£ç›˜ç©ºé—´ã€‚
CannotInstallToNetworkDrive=å®‰è£…ç¨‹åºæ— æ³•å®‰è£…åˆ°ä¸€ä¸ªç½‘ç»œé©±åŠ¨å™¨ã€‚
CannotInstallToUNCPath=å®‰è£…ç¨‹åºæ— æ³•å®‰è£…åˆ°ä¸€ä¸ª UNC è·¯å¾„ã€‚
InvalidPath=ä½ å¿…é¡»è¾“å…¥ä¸€ä¸ªåŒ…å«ç›˜ç¬¦çš„å®Œæ•´è·¯å¾„ï¼›ä¾‹å¦‚:%n%nC:\APP%n%næˆ–ä¸€ä¸ªç½‘ç»œè·¯å¾„ï¼Œä¾‹å¦‚:%n%n\\server\share
InvalidDrive=ä½ é€‰å®šçš„é©±åŠ¨å™¨æˆ– UNC å…±äº«ä¸å­˜åœ¨æˆ–ä¸èƒ½è®¿é—®ã€‚è¯·å¦å¤–é€‰æ‹©ã€‚
DiskSpaceWarningTitle=æ²¡æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
DiskSpaceWarning=å®‰è£…ç¨‹åºè‡³å°‘éœ€è¦ %1 KB çš„å¯ç”¨ç£ç›˜ç©ºé—´æ‰èƒ½å®‰è£…ï¼Œä½†é€‰å®šçš„é©±åŠ¨å™¨åªæœ‰ %2 KB çš„å¯ç”¨ç©ºé—´ã€‚%n%nä½ ä¸€å®šè¦ç»§ç»­å—ï¼Ÿ
DirNameTooLong=æ–‡ä»¶å¤¹åç§°æˆ–è·¯å¾„å¤ªé•¿ã€‚
InvalidDirName=æ–‡ä»¶å¤¹åç§°æ— æ•ˆã€‚
BadDirName32=æ–‡ä»¶å¤¹åç§°ä¸èƒ½åŒ…å«ä¸‹åˆ—ä»»ä½•å­—ç¬¦:%n%n%1
DirExistsTitle=æ–‡ä»¶å¤¹å·²å­˜åœ¨
DirExists=æ–‡ä»¶å¤¹:%n%n%1%n%nå·²ç»å­˜åœ¨ã€‚ä½ ä¸€å®šè¦å®‰è£…åˆ°é‚£ä¸ªæ–‡ä»¶å¤¹å—ï¼Ÿ
DirDoesntExistTitle=æ–‡ä»¶å¤¹ä¸å­˜åœ¨
DirDoesntExist=æ–‡ä»¶å¤¹:%n%n%1%n%nä¸å­˜åœ¨ã€‚ä½ æƒ³åˆ›å»ºå®ƒå—ï¼Ÿ

; *** "Select Components" wizard page
WizardSelectComponents=é€‰æ‹©ç»„ä»¶
SelectComponentsDesc=ä½ æƒ³å®‰è£…å“ªäº›ç»„ä»¶ï¼Ÿ
SelectComponentsLabel2=é€‰æ‹©ä½ æƒ³è¦å®‰è£…çš„ç»„ä»¶ï¼›æ¸…é™¤ä½ ä¸æƒ³å®‰è£…çš„ç»„ä»¶ã€‚ç„¶åå•å‡»â€œä¸‹ä¸€æ­¥â€ç»§ç»­ã€‚
FullInstallation=å®Œå…¨å®‰è£…
; if possible don't translate 'Compact' as 'Minimal' (I mean 'Minimal' in your language)
CompactInstallation=ç®€æ´å®‰è£…
CustomInstallation=è‡ªå®šä¹‰å®‰è£…
NoUninstallWarningTitle=ç»„ä»¶å­˜åœ¨
NoUninstallWarning=å®‰è£…ç¨‹åºæ£€æµ‹åˆ°ä¸‹åˆ—ç»„ä»¶å·²åœ¨ä½ çš„è®¡ç®—æœºä¸­å®‰è£…:%n%n%1%n%nå–æ¶ˆé€‰æ‹©è¿™äº›ç»„ä»¶å°†ä¸ä¼šå¸è½½å®ƒä»¬ã€‚%n%nä½ ä¸€å®šè¦ç»§ç»­å—ï¼Ÿ
ComponentSize1=%1 KB
ComponentSize2=%1 MB
ComponentsDiskSpaceMBLabel=å½“å‰é€‰æ‹©è‡³å°‘éœ€è¦ [mb] MB çš„å¯ç”¨ç£ç›˜ç©ºé—´ã€‚

; *** "Select Additional Tasks" wizard page
WizardSelectTasks=é€‰æ‹©é™„åŠ ä»»åŠ¡
SelectTasksDesc=ä½ æƒ³æ‰§è¡Œå“ªäº›é™„åŠ ä»»åŠ¡ï¼Ÿ
SelectTasksLabel2=é€‰æ‹©åœ¨å®‰è£… [name] æ—¶è¦æ‰§è¡Œçš„é™„åŠ ä»»åŠ¡ï¼Œç„¶åå•å‡»â€œä¸‹ä¸€æ­¥â€ã€‚

; *** "Select Start Menu Folder" wizard page
WizardSelectProgramGroup=é€‰æ‹©å¼€å§‹èœå•æ–‡ä»¶å¤¹
SelectStartMenuFolderDesc=å®‰è£…ç¨‹åºåº”è¯¥åœ¨å“ªé‡Œæ”¾ç½®ç¨‹åºçš„å¿«æ·æ–¹å¼ï¼Ÿ
SelectStartMenuFolderLabel3=å®‰è£…ç¨‹åºå°†åœ¨ä¸‹åˆ—â€œå¼€å§‹â€èœå•æ–‡ä»¶å¤¹ä¸­åˆ›å»ºç¨‹åºçš„å¿«æ·æ–¹å¼ã€‚
SelectStartMenuFolderBrowseLabel=è‹¥è¦ç»§ç»­ï¼Œå•å‡»â€œä¸‹ä¸€æ­¥â€ã€‚å¦‚æœä½ æƒ³é€‰æ‹©å…¶å®ƒæ–‡ä»¶å¤¹ï¼Œå•å‡»â€œæµè§ˆâ€ã€‚
MustEnterGroupName=ä½ å¿…é¡»è¾“å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹åç§°ã€‚
GroupNameTooLong=æ–‡ä»¶å¤¹åç§°æˆ–è·¯å¾„å¤ªé•¿ã€‚
InvalidGroupName=æ–‡ä»¶å¤¹åç§°æ— æ•ˆã€‚
BadGroupName=æ–‡ä»¶å¤¹åç§°ä¸èƒ½åŒ…å«ä¸‹åˆ—ä»»ä½•å­—ç¬¦:%n%n%1
NoProgramGroupCheck2=ä¸åˆ›å»ºâ€œå¼€å§‹â€èœå•æ–‡ä»¶å¤¹(&D)

; *** "Ready to Install" wizard page
WizardReady=å‡†å¤‡å®‰è£…
ReadyLabel1=å®‰è£…ç¨‹åºç°åœ¨å‡†å¤‡å¼€å§‹å®‰è£… [name] åˆ°ä½ çš„è®¡ç®—æœºã€‚
ReadyLabel2a=å•å‡»â€œå®‰è£…â€ç»§ç»­æ­¤å®‰è£…ç¨‹åºã€‚å¦‚æœä½ æƒ³å›é¡¾æˆ–æ”¹å˜è®¾ç½®ï¼Œè¯·å•å‡»â€œä¸Šä¸€æ­¥â€ã€‚
ReadyLabel2b=å•å‡»â€œå®‰è£…â€ç»§ç»­æ­¤å®‰è£…ç¨‹åºï¼Ÿå¦‚æœä½ æƒ³å›é¡¾æˆ–æ”¹å˜è®¾ç½®ï¼Œè¯·å•å‡»â€œä¸Šä¸€æ­¥â€ã€‚
ReadyMemoUserInfo=ç”¨æˆ·ä¿¡æ¯:
ReadyMemoDir=ç›®æ ‡ä½ç½®:
ReadyMemoType=å®‰è£…ç±»å‹:
ReadyMemoComponents=é€‰å®šç»„ä»¶:
ReadyMemoGroup=â€œå¼€å§‹â€èœå•æ–‡ä»¶å¤¹:
ReadyMemoTasks=é™„åŠ ä»»åŠ¡:

; *** "Preparing to Install" wizard page
WizardPreparing=æ­£åœ¨å‡†å¤‡å®‰è£…
PreparingDesc=å®‰è£…ç¨‹åºæ­£åœ¨å‡†å¤‡å®‰è£… [name] åˆ°ä½ çš„è®¡ç®—æœºã€‚
PreviousInstallNotCompleted=å…ˆå‰çš„ç¨‹åºå®‰è£…/å¸è½½æœªå®Œæˆã€‚ä½ éœ€è¦é‡æ–°å¯åŠ¨ä½ çš„è®¡ç®—æœºæ‰èƒ½å®Œæˆå®‰è£…ã€‚%n%nåœ¨é‡æ–°å¯åŠ¨è®¡ç®—æœºåï¼Œè¯·è¿è¡Œå®‰è£…ç¨‹åºå®Œæˆ [name] çš„å®‰è£…ã€‚
CannotContinue=å®‰è£…ç¨‹åºä¸èƒ½ç»§ç»­ã€‚è¯·å•å‡»â€œå–æ¶ˆâ€é€€å‡ºã€‚
ApplicationsFound=ä¸‹åˆ—åº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨éœ€è¦æ›´æ–°çš„æ–‡ä»¶ã€‚å»ºè®®ä½ å…è®¸å®‰è£…ç¨‹åºè‡ªåŠ¨å…³é—­è¿™äº›åº”ç”¨ç¨‹åºã€‚
ApplicationsFound2=ä¸‹åˆ—åº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨éœ€è¦æ›´æ–°çš„æ–‡ä»¶ã€‚å»ºè®®ä½ å…è®¸å®‰è£…ç¨‹åºè‡ªåŠ¨å…³é—­è¿™äº›åº”ç”¨ç¨‹åºã€‚å®‰è£…å®Œæˆåï¼Œå®‰è£…ç¨‹åºå°†å°è¯•é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºã€‚
CloseApplications=è‡ªåŠ¨å…³é—­åº”ç”¨ç¨‹åº(&A)
DontCloseApplications=ä¸è¦å…³é—­åº”ç”¨ç¨‹åº(&D)
ErrorCloseApplications=å®‰è£…ç¨‹åºæ— æ³•è‡ªåŠ¨å…³é—­æ‰€æœ‰åº”ç”¨ç¨‹åºã€‚å»ºè®®ä½ åœ¨ç»§ç»­å®‰è£…ä¹‹å‰ï¼Œå…³é—­æ‰€æœ‰ä½¿ç”¨éœ€è¦æ›´æ–°çš„æ–‡ä»¶çš„åº”ç”¨ç¨‹åºã€‚

; *** "Installing" wizard page
WizardInstalling=æ­£åœ¨å®‰è£…
InstallingLabel=å®‰è£…ç¨‹åºæ­£åœ¨å®‰è£… [name] åˆ°ä½ çš„è®¡ç®—æœºï¼Œè¯·ç¨å€™ã€‚

; *** "Setup Completed" wizard page
FinishedHeadingLabel=[name] å®‰è£…å®Œæˆå‘å¯¼
FinishedLabelNoIcons=å®‰è£…ç¨‹åºå·²åœ¨ä½ çš„è®¡ç®—æœºä¸­å®‰è£…äº† [name]ã€‚
FinishedLabel=å®‰è£…ç¨‹åºå·²åœ¨ä½ çš„è®¡ç®—æœºä¸­å®‰è£…äº† [name]ã€‚å¯ä»¥é€šè¿‡é€‰æ‹©å®‰è£…çš„å¿«æ·æ–¹å¼è¿è¡Œåº”ç”¨ç¨‹åºã€‚
ClickFinish=å•å‡»â€œå®Œæˆâ€é€€å‡ºå®‰è£…ç¨‹åºã€‚
FinishedRestartLabel=ä¸ºäº†å®Œæˆ [name] çš„å®‰è£…ï¼Œå®‰è£…ç¨‹åºå¿…é¡»é‡æ–°å¯åŠ¨ä½ çš„è®¡ç®—æœºã€‚ä½ æƒ³ç°åœ¨é‡æ–°å¯åŠ¨å—ï¼Ÿ
FinishedRestartMessage=ä¸ºäº†å®Œæˆ [name] çš„å®‰è£…ï¼Œå®‰è£…ç¨‹åºå¿…é¡»é‡æ–°å¯åŠ¨ä½ çš„è®¡ç®—æœºã€‚%n%nä½ æƒ³ç°åœ¨é‡æ–°å¯åŠ¨å—ï¼Ÿ
ShowReadmeCheck=æ˜¯ï¼Œæˆ‘æƒ³é˜…è¯» README æ–‡ä»¶
YesRadio=æ˜¯ï¼Œç«‹å³é‡æ–°å¯åŠ¨è®¡ç®—æœº(&Y)
NoRadio=å¦ï¼Œæˆ‘ç¨åé‡æ–°å¯åŠ¨è®¡ç®—æœº(&N)
; used for example as 'Run MyProg.exe'
RunEntryExec=è¿è¡Œ %1
; used for example as 'View README.txt'
RunEntryShellExec=é˜…è¯» %1

; *** "Setup Needs the Next Disk" stuff
ChangeDiskTitle=éœ€è¦ä¸‹ä¸€ä¸ªç£ç›˜
SelectDiskLabel2=è¯·æ’å…¥ç£ç›˜ %1 å¹¶å•å‡»â€œç¡®å®šâ€ã€‚%n%nå¦‚æœè¿™ä¸ªç£ç›˜ä¸­çš„æ–‡ä»¶å¯ä»¥åœ¨å…¶å®ƒæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ° (ä¸åŒäºä¸‹é¢æ˜¾ç¤ºçš„)ï¼Œè¯·è¾“å…¥æ­£ç¡®çš„è·¯å¾„æˆ–å•å‡»â€œæµè§ˆâ€ã€‚
PathLabel=è·¯å¾„(&P):
FileNotInDir2=åœ¨ "%2" ä¸­æ‰¾ä¸åˆ°æ–‡ä»¶ "%1"ã€‚è¯·æ’å…¥æ­£ç¡®çš„ç£ç›˜æˆ–é€‰æ‹©å…¶å®ƒæ–‡ä»¶å¤¹ã€‚
SelectDirectoryLabel=è¯·è¾“å…¥ä¸‹ä¸€ä¸ªç£ç›˜çš„ä½ç½®ã€‚

; *** Installation phase messages
SetupAborted=å®‰è£…æœªå®Œæˆã€‚%n%nè¯·æ›´æ­£é—®é¢˜åé‡æ–°è¿è¡Œå®‰è£…ç¨‹åºã€‚
EntryAbortRetryIgnore=å•å‡»â€œé‡è¯•â€é‡è¯•ï¼Œå•å‡»â€œå¿½ç•¥â€å¿½ç•¥è¿™ä¸ªé”™è¯¯ç»§ç»­ï¼Œæˆ–å•å‡»â€œä¸­æ­¢â€å–æ¶ˆå®‰è£…ã€‚

; *** Installation status messages
StatusClosingApplications=æ­£åœ¨å…³é—­åº”ç”¨ç¨‹åº...
StatusCreateDirs=æ­£åœ¨åˆ›å»ºç›®å½•...
StatusExtractFiles=æ­£åœ¨è§£å‹ç¼©æ–‡ä»¶...
StatusCreateIcons=æ­£åœ¨åˆ›å»ºå¿«æ·æ–¹å¼...
StatusCreateIniEntries=æ­£åœ¨åˆ›å»º INI æ¡ç›®...
StatusRegisterFiles=æ­£åœ¨æ³¨å†Œæ–‡ä»¶...
StatusDeleteFiles=æ­£åœ¨åˆ é™¤æ–‡ä»¶...
StatusRunProgram=æ­£åœ¨å®Œæˆå®‰è£…...
StatusRestartingApplications=æ­£åœ¨é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åº...
StatusRollback=æ­£åœ¨æ’¤é”€æ›´æ”¹...

; *** Misc. errors
ErrorInternal2=å†…éƒ¨é”™è¯¯: %1
ErrorFunctionFailedNoCode=%1 å¤±è´¥
ErrorFunctionFailed=%1 å¤±è´¥; ä»£ç  %2
ErrorFunctionFailedWithMessage=%1 å¤±è´¥; ä»£ç  %2.%n%3
ErrorExecutingROW=åœ¨æ‰§è¡Œæ–‡ä»¶æ—¶å‡ºé”™:%n%1

--- END: build_scripts/ChineseSimplified.isl ---


--- START: build_scripts/linux_build.sh ---

#!/bin/bash

# åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•
cd "$(dirname "$0")/.."

# æ¸…ç†
rm -rf dist build *.spec

echo "Building CodeSync for Linux..."

# ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶
# Linux ä¸‹æˆ‘ä»¬ä¹ŸæŠŠèµ„æºæ‰“åŒ…è¿›å»ï¼Œæ–¹ä¾¿å•æ–‡ä»¶åˆ†å‘
pyinstaller --noconsole --onefile --name "CodeSync" \
    --add-data "assets/lang.json:assets" \
    src/main.py

echo "Build complete. Check 'dist/CodeSync'"

--- END: build_scripts/linux_build.sh ---


--- START: build_scripts/mac_build.sh ---

#!/bin/bash

# åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•
cd "$(dirname "$0")/.."

# æ¸…ç†
rm -rf dist build *.spec

echo "Building CodeSync for macOS..."

# ç”Ÿæˆ .app
# æ³¨æ„ï¼šmacOS ä¸‹é€šå¸¸å»ºè®®æŠŠèµ„æºæ‰“åŒ…è¿› .app å†…éƒ¨ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ --add-data
# æ ¼å¼ source:dest
# å¦‚æœä½ æœ‰ icon.icnsï¼Œå–æ¶ˆæ³¨é‡Š --icon å‚æ•°
pyinstaller --noconsole --windowed --name "CodeSync" \
    --add-data "assets/lang.json:assets" \
    src/main.py
    # --icon "assets/icon.icns" \

echo "Build complete. Check 'dist/CodeSync.app'"

--- END: build_scripts/mac_build.sh ---


--- START: build_scripts/win_build.bat ---

@echo off
setlocal

echo ==============================================
echo      CodeSync Windows Builder (Fixed)
echo ==============================================

:: 1. åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•
cd /d "%~dp0.."
echo Current Work Dir: %cd%

:: 2. æ™ºèƒ½æ£€æµ‹è™šæ‹Ÿç¯å¢ƒ
if exist ".venv\Scripts\python.exe" (
    set "PY_CMD=.venv\Scripts\python.exe"
    echo [INFO] Using virtual environment: .venv
) else if exist "venv\Scripts\python.exe" (
    set "PY_CMD=venv\Scripts\python.exe"
    echo [INFO] Using virtual environment: venv
) else (
    set "PY_CMD=python"
    echo [WARN] Using system Python.
)

:: 3. ç¡®ä¿å®‰è£…äº† PyInstaller
echo.
echo [1/4] Checking PyInstaller...
"%PY_CMD%" -m pip install pyinstaller
if %errorlevel% neq 0 (
    echo [ERROR] Failed to install PyInstaller.
    pause
    exit /b 1
)

:: 4. æ¸…ç†æ—§æ„å»º
echo.
echo [2/4] Cleaning up...
if exist "dist" rmdir /s /q "dist"
if exist "build" rmdir /s /q "build"
if exist "CodeSync.spec" del "CodeSync.spec"

:: 5. æ‰§è¡Œæ‰“åŒ… (æ ¸å¿ƒä¿®æ”¹åœ¨è¿™é‡Œ)
:: --paths "src": å‘Šè¯‰ PyInstaller å» src ç›®å½•ä¸‹æ‰¾ import çš„æ¨¡å—
echo.
echo [3/4] Building EXE...
"%PY_CMD%" -m PyInstaller --noconsole --onefile --name "CodeSync" --clean ^
    --paths "src" ^
    --add-data "assets/lang.json;assets" ^
    --add-data "VERSION;." ^
    src/main.py

:: 6. æ£€æŸ¥ç»“æœ
echo.
if exist "dist\CodeSync.exe" (
    echo [4/4] Build Success!
    echo ------------------------------------------
    echo EXE Location: dist\CodeSync.exe
    echo.
    echo Now you can run 'build_scripts\win_setup.iss' to create the installer.
) else (
    echo [ERROR] Build Failed! Check the log above.
)

echo.
pause

--- END: build_scripts/win_build.bat ---


--- START: build_scripts/win_setup.iss ---

; è„šæœ¬ä½ç½®ï¼šCodeSync/build_scripts/win_setup.iss

; =================================================================
; 1. é¢„å¤„ç†å™¨ï¼šåŠ¨æ€è¯»å–ç‰ˆæœ¬å·å’Œæ¶æ„
; =================================================================

; --- è¯»å–æ ¹ç›®å½•çš„ VERSION æ–‡ä»¶ ---
#define FileHandle
#define FileLine
#if FileHandle = FileOpen("..\VERSION")
  #define FileLine = FileRead(FileHandle)
  #expr FileClose(FileHandle)
#endif

; å¦‚æœè¯»å–å¤±è´¥ï¼Œé»˜è®¤ 1.0.0
#ifdef FileLine
  #define MyAppVersion FileLine
#else
  #define MyAppVersion "1.0.0"
#endif

; --- æ¥æ”¶å‘½ä»¤è¡Œå‚æ•° (æ¶æ„) ---
; GitHub Actions ä¼šé€šè¿‡ /DMyAppArch="x64" ä¼ å…¥ï¼Œæœ¬åœ°é»˜è®¤ä¸º x64
#ifndef MyAppArch
  #define MyAppArch "x64"
#endif

#define MyAppName "ä»£ç åŒæ­¥ (CodeSync)"
#define MyAppPublisher "Ryan"
#define MyAppExeName "CodeSync.exe"

; =================================================================
; 2. å®‰è£…ç¨‹åºæ ¸å¿ƒè®¾ç½®
; =================================================================
[Setup]
AppId={{A3D8C9B0-1234-5678-ABCD-EFEFEFEFEFEF}
AppName={#MyAppName}
AppVersion={#MyAppVersion}
AppPublisher={#MyAppPublisher}
DefaultGroupName=CodeSync

; --- æ¶æ„é€‚é… ---
#if MyAppArch == "x64"
  ArchitecturesAllowed=x64
  ArchitecturesInstallIn64BitMode=x64
#endif

; é»˜è®¤å®‰è£…ç›®å½•
DefaultDirName={autopf}\CodeSync

; --- è¾“å‡ºè®¾ç½® ---
; è¾“å‡ºæ–‡ä»¶åæ ¼å¼ï¼šCodeSync_Setup_v1.0.8_x64
OutputBaseFilename=CodeSync_Setup_v{#MyAppVersion}_{#MyAppArch}
OutputDir=..\Output

Compression=lzma
SolidCompression=yes
SetupIconFile=..\assets\icon.ico

; --- ç•Œé¢ä¸é€»è¾‘ ---
; éšè—åŸæœ¬çš„â€œé€‰æ‹©å¼€å§‹èœå•æ–‡ä»¶å¤¹â€é¡µé¢ (æ”¹ç”¨ Tasks æ§åˆ¶)
DisableProgramGroupPage=yes
; å…è®¸é€‰æ‹©å®‰è£…ç›®å½•
DisableDirPage=no
; å¸è½½ç›¸å…³
CloseApplications=yes
RestartApplications=no

; =================================================================
; 3. å¤šè¯­è¨€æ”¯æŒ
; =================================================================
[Languages]
; ç¡®ä¿ ChineseSimplified.isl å°±åœ¨ .iss åŒçº§ç›®å½•ä¸‹
Name: "chinesesimplified"; MessagesFile: "ChineseSimplified.isl"
Name: "english"; MessagesFile: "compiler:Default.isl"

; === è‡ªå®šä¹‰ç¿»è¯‘ (è§£å†³ç¡¬ç¼–ç è‹±æ–‡é—®é¢˜) ===
[CustomMessages]
; è¦†ç›–é»˜è®¤çš„â€œé™„åŠ å›¾æ ‡â€æ ‡é¢˜
english.AdditionalIcons=Additional shortcuts
chinesesimplified.AdditionalIcons=é™„åŠ å¿«æ·æ–¹å¼

; è¦†ç›–é»˜è®¤çš„â€œåˆ›å»ºæ¡Œé¢å›¾æ ‡â€æè¿°
english.CreateDesktopIcon=Create a desktop shortcut
chinesesimplified.CreateDesktopIcon=åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼

; æ–°å¢â€œåˆ›å»ºå¼€å§‹èœå•å›¾æ ‡â€æè¿°
english.CreateStartMenuIcon=Create a Start Menu shortcut
chinesesimplified.CreateStartMenuIcon=åˆ›å»ºå¼€å§‹èœå•å¿«æ·æ–¹å¼

; =================================================================
; 4. ä»»åŠ¡åˆ—è¡¨ (é™„åŠ ä»»åŠ¡é¡µé¢)
; =================================================================
[Tasks]
; æ¡Œé¢å¿«æ·æ–¹å¼
Name: "desktopicon"; Description: "{cm:CreateDesktopIcon}"; GroupDescription: "{cm:AdditionalIcons}"

; å¼€å§‹èœå•å¿«æ·æ–¹å¼ (æ–°å¢)
Name: "startmenuicon"; Description: "{cm:CreateStartMenuIcon}"; GroupDescription: "{cm:AdditionalIcons}"

; =================================================================
; 5. æ–‡ä»¶æ‰“åŒ…
; =================================================================
[Files]
; ä¸»ç¨‹åº
Source: "..\dist\{#MyAppExeName}"; DestDir: "{app}"; Flags: ignoreversion
; è¯­è¨€åŒ… & ç‰ˆæœ¬æ–‡ä»¶ (æ”¾åˆ°å®‰è£…ç›®å½•ä¸‹çš„ assets æ–‡ä»¶å¤¹ï¼Œæˆ–è€…ç›´æ¥æ”¾æ ¹ç›®å½•çœ‹ä½ ä»£ç æ€ä¹ˆå†™çš„)
; æ ¹æ®ä½ ä¹‹å‰çš„ä»£ç é€»è¾‘ï¼Œlang.json åœ¨ assets å­ç›®å½•
Source: "..\assets\lang.json"; DestDir: "{app}\assets"; Flags: ignoreversion

; =================================================================
; 6. å¿«æ·æ–¹å¼ç”Ÿæˆ
; =================================================================
[Icons]
; å¼€å§‹èœå•å›¾æ ‡ (ä»…å½“å‹¾é€‰ startmenuicon æ—¶åˆ›å»º)
Name: "{group}\{#MyAppName}"; Filename: "{app}\{#MyAppExeName}"; Tasks: startmenuicon
Name: "{group}\{cm:UninstallProgram,{#MyAppName}}"; Filename: "{uninstallexe}"; Tasks: startmenuicon

; æ¡Œé¢å›¾æ ‡ (ä»…å½“å‹¾é€‰ desktopicon æ—¶åˆ›å»º)
Name: "{autodesktop}\{#MyAppName}"; Filename: "{app}\{#MyAppExeName}"; Tasks: desktopicon

; =================================================================
; 7. è¿è¡Œ
; =================================================================
[Run]
Filename: "{app}\{#MyAppExeName}"; Description: "{cm:LaunchProgram,{#MyAppName}}"; Flags: nowait postinstall skipifsilent

; =================================================================
; 8. Pascal è„šæœ¬ (å¸è½½é€»è¾‘)
; =================================================================
[Code]
// 1. åˆå§‹åŒ–å¸è½½ï¼šå¼ºåˆ¶å…³é—­æ­£åœ¨è¿è¡Œçš„è½¯ä»¶
function InitializeUninstall(): Boolean;
var
  ErrorCode: Integer;
begin
  // è¿è¡Œ taskkill å‘½ä»¤å¼ºåˆ¶ç»“æŸ CodeSync.exe è¿›ç¨‹
  ShellExec('open', 'taskkill.exe', '/F /IM {#MyAppExeName} /T', '', SW_HIDE, ewWaitUntilTerminated, ErrorCode);
  Result := True;
end;

// 2. å¸è½½æ­¥éª¤å˜æ›´ï¼šè¯¢é—®æ˜¯å¦åˆ é™¤é…ç½®æ–‡ä»¶
procedure CurUninstallStepChanged(CurUninstallStep: TUninstallStep);
begin
  if CurUninstallStep = usUninstall then
  begin
    if MsgBox('æ˜¯å¦åŒæ—¶åˆ é™¤æœ¬åœ°çš„é…ç½®æ–‡ä»¶å’Œç¼“å­˜æ•°æ®ï¼Ÿ' #13#13 'è¿™å°†åˆ é™¤æ‰€æœ‰ä¿å­˜çš„é¡¹ç›®è®°å½•ã€ä¸»é¢˜å’Œè¯­è¨€è®¾ç½®ã€‚', mbConfirmation, MB_YESNO) = IDYES then
    begin
      // åˆ é™¤ %APPDATA%\CodeSync æ–‡ä»¶å¤¹
      DelTree(ExpandConstant('{userappdata}\CodeSync'), True, True, True);
    end;
  end;
end;

--- END: build_scripts/win_setup.iss ---


--- START: server/docker-compose.yml ---

version: '3.8'

services:
  codesync-server:
    # Official Image
    image: ghcr.io/ryanzhou416/codesync/codesync-server:latest
    container_name: codesync_server
    # Restart policy
    restart: always
    ports:
      # Port Mapping: "HostPort:ContainerPort"
      # You can change the 8000 on the left to any port you want
      - "8000:8000"
    environment:
      - PYTHONUNBUFFERED=1

--- END: server/docker-compose.yml ---


--- START: server/Dockerfile ---

# ä½¿ç”¨å®˜æ–¹è½»é‡ Python é•œåƒ
FROM python:3.9-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ç¯å¢ƒå˜é‡ï¼šé˜²æ­¢ç”Ÿæˆ .pyc æ–‡ä»¶ï¼Œä¿è¯æ—¥å¿—å®æ—¶æ‰“å°
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

# å®‰è£…ä¾èµ–
# æ³¨æ„ï¼šserver.py ç”¨åˆ°äº† fastapi å’Œ uvicorn
RUN pip install --no-cache-dir fastapi uvicorn

# å¤åˆ¶å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åˆ°å®¹å™¨çš„ /app
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "server:app", "--host", "0.0.0.0", "--port", "8000"]

--- END: server/Dockerfile ---


--- START: server/server.py ---

import hashlib
import json
from fastapi import FastAPI, HTTPException, Request
from fastapi.responses import PlainTextResponse, HTMLResponse
import uvicorn
from typing import Dict, List

app = FastAPI()

project_store: Dict[str, str] = {}
hash_cache: Dict[str, str] = {}
config_store: Dict[str, List[str]] = {}


def calculate_hash(content: str) -> str:
    return hashlib.md5(content.encode('utf-8')).hexdigest()


@app.get("/", response_class=HTMLResponse)
async def index():
    links = "".join([f'<li><a href="/{k}">{k}</a></li>' for k in project_store.keys()])
    return f"<h1>Code Context Server</h1><ul>{links}</ul>"


@app.post("/upload/{project_name}")
async def upload_project(project_name: str, request: Request):
    content = await request.body()
    text_data = content.decode("utf-8", errors="replace")
    project_store[project_name] = text_data
    hash_cache[project_name] = calculate_hash(text_data)
    return {"status": "success", "hash": hash_cache[project_name]}


@app.get("/{project_name}", response_class=PlainTextResponse)
async def get_project(project_name: str):
    if project_name not in project_store:
        raise HTTPException(status_code=404, detail="Project not found")
    return project_store[project_name]


@app.get("/hash/{project_name}")
async def get_project_hash(project_name: str):
    if project_name not in hash_cache: return {"hash": None}
    return {"hash": hash_cache[project_name]}


@app.post("/config/{project_name}")
async def save_config(project_name: str, request: Request):
    try:
        config_store[project_name] = await request.json()
        return {"status": "saved"}
    except Exception as e:
        raise HTTPException(status_code=400, detail=str(e))


@app.get("/config/{project_name}")
async def get_config(project_name: str):
    return config_store.get(project_name, [])


# === æ–°å¢ï¼šåˆ é™¤æ¥å£ ===
@app.delete("/project/{project_name}")
async def delete_project(project_name: str):
    deleted = False
    if project_name in project_store:
        del project_store[project_name]
        deleted = True
    if project_name in hash_cache:
        del hash_cache[project_name]
    if project_name in config_store:
        del config_store[project_name]

    return {"status": "deleted" if deleted else "not_found"}


if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)

--- END: server/server.py ---


--- START: src/__init__.py ---



--- END: src/__init__.py ---


--- START: src/config.py ---

import os
import sys
import platform

# è½¯ä»¶åŸºç¡€ä¿¡æ¯
APP_NAME = "CodeSync"

# é»˜è®¤å¿½ç•¥æ–‡ä»¶
DEFAULT_IGNORE = {
    '.git', '.vs', '.idea', '__pycache__', 'node_modules',
    'build', 'target', 'bin', 'obj', '.gradle', '.dart_tool',
    '.vscode', '.DS_Store'
}

# äºŒè¿›åˆ¶æ–‡ä»¶åç¼€
BINARY_EXTS = {
    '.png', '.jpg', '.jpeg', '.gif', '.ico', '.exe', '.dll', '.so',
    '.pdf', '.zip', '.db', '.sqlite', '.pyc', '.class', '.jar',
    '.webp', '.lib', '.pdb', '.o', '.a', '.mp4', '.mov'
}


def get_app_data_dir():
    """è·å–è·¨å¹³å°çš„åº”ç”¨é…ç½®å­˜å‚¨ç›®å½•"""
    system = platform.system()

    if system == "Windows":
        base = os.environ.get('APPDATA')
    elif system == "Darwin":  # macOS
        base = os.path.expanduser("~/Library/Application Support")
    else:  # Linux
        base = os.path.expanduser("~/.config")

    path = os.path.join(base, APP_NAME)
    if not os.path.exists(path):
        os.makedirs(path)
    return path


def get_resource_path(relative_path):
    """
    è·å–èµ„æºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚
    å…¼å®¹å¼€å‘ç¯å¢ƒ(ç›´æ¥è¿è¡Œæºç )å’Œç”Ÿäº§ç¯å¢ƒ(PyInstalleræ‰“åŒ…å)ã€‚
    """
    if hasattr(sys, '_MEIPASS'):
        # PyInstaller æ‰“åŒ…åçš„ä¸´æ—¶ç›®å½•
        return os.path.join(sys._MEIPASS, relative_path)
    # å¼€å‘ç¯å¢ƒï¼šåŸºäºå½“å‰å·¥ä½œç›®å½•
    return os.path.join(os.path.abspath("."), relative_path)


# å…¨å±€è·¯å¾„å¸¸é‡
CONFIG_DIR = get_app_data_dir()
CONFIG_FILE = os.path.join(CONFIG_DIR, "config.json")

# è¯­è¨€æ–‡ä»¶è·¯å¾„ (ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•/æ‰“åŒ…æ ¹ç›®å½•)
LANG_FILE_REL = os.path.join("assets", "lang.json")


def get_version():
    """è¯»å–æ ¹ç›®å½•çš„ VERSION æ–‡ä»¶"""
    try:
        # å¼€å‘ç¯å¢ƒ
        version_file = os.path.join(os.path.dirname(os.path.dirname(os.path.abspath(__file__))), "VERSION")
        # æ‰“åŒ…ç¯å¢ƒ (PyInstaller ä¼šæŠŠ VERSION æ‰“åŒ…è¿› sys._MEIPASS)
        if getattr(sys, 'frozen', False):
            version_file = os.path.join(sys._MEIPASS, "VERSION")

        with open(version_file, "r") as f:
            return f.read().strip()
    except:
        return "1.0.0"


APP_VERSION = get_version()

--- END: src/config.py ---


--- START: src/gui.py ---

import os
import json
import webbrowser
import tkinter as tk
from tkinter import ttk, filedialog, messagebox
import requests
import hashlib
import locale

# å¯¼å…¥åŒç›®å½•ä¸‹çš„æ¨¡å—
import config
import utils
import logic

# çŠ¶æ€å›¾æ ‡
ICON_UNCHECKED = "â˜"
ICON_CHECKED = "â˜‘"
ICON_PARTIAL = "âŠŸ"
ICON_BIN = ""


class CodeSyncApp:
    def __init__(self, root):
        self.root = root
        self.root.geometry("950x850")

        self.node_data = {}
        self.all_configs = {}
        self.project_list = {}
        self.gitignore_patterns = []
        self.translations = {}

        # åŠ è½½è¯­è¨€åŒ…
        self._load_translations()

        # å˜é‡åˆå§‹åŒ–
        self.name_var = tk.StringVar()
        self.url_var = tk.StringVar(value="https://code.ryan416.com")
        self.path_var = tk.StringVar()
        self.sort_mode = tk.StringVar(value="name")
        self.sort_desc = tk.BooleanVar(value=False)
        self.lang_var = tk.StringVar(value="en")
        self.theme_var = tk.StringVar(value="system")

        # é…ç½®åŠ è½½é¡ºåºï¼šæœ¬åœ°é…ç½® -> åˆå§‹è®¾ç½® -> æ„å»ºUI -> åº”ç”¨ä¸»é¢˜ -> æ¢å¤é¡¹ç›®
        self._load_local_config()
        self._detect_initial_settings()

        self._build_ui()
        # å¼ºåˆ¶åˆ·æ–°ç¡®ä¿ Windows å¥æŸ„å­˜åœ¨ï¼Œä»¥ä¾¿åº”ç”¨æ·±è‰²æ ‡é¢˜æ 
        self.root.update()
        self._apply_theme()

        self._refresh_project_combo()
        last = self.all_configs.get("last_active", "")
        if last and last in self.project_list:
            self.project_combo.set(last)
            self.root.after(100, lambda: self.switch_project(None))

    def _load_translations(self):
        # ä½¿ç”¨ config æ¨¡å—è·å–èµ„æºè·¯å¾„
        lang_path = config.get_resource_path(config.LANG_FILE_REL)
        try:
            with open(lang_path, 'r', encoding='utf-8') as f:
                self.translations = json.load(f)
        except Exception as e:
            # å¦‚æœåŠ è½½å¤±è´¥ï¼Œæä¾›æœ€åŸºç¡€çš„è‹±æ–‡å›é€€ï¼Œé˜²æ­¢å´©æºƒ
            messagebox.showerror("Error", f"Cannot load languages from:\n{lang_path}\nError: {e}")
            self.translations = {"en": {}, "zh": {}}

    def tr(self, key):
        """ç¿»è¯‘å¸®åŠ©å‡½æ•°"""
        lang = self.lang_var.get()
        dct = self.translations.get(lang, self.translations.get("en", {}))
        return dct.get(key, key)

    def _detect_initial_settings(self):
        # è¯­è¨€æ£€æµ‹
        if "language" in self.all_configs:
            self.lang_var.set(self.all_configs["language"])
        else:
            try:
                sys_lang = locale.getdefaultlocale()[0]
                if sys_lang and "zh" in sys_lang.lower():
                    self.lang_var.set("zh")
                else:
                    self.lang_var.set("en")
            except:
                self.lang_var.set("en")

        # ä¸»é¢˜æ£€æµ‹
        if "theme" in self.all_configs:
            self.theme_var.set(self.all_configs["theme"])
        else:
            self.theme_var.set("system")

        self._save_local_config()

    # === é…ç½®ä¸é‡ç½® ===
    def _load_local_config(self):
        if os.path.exists(config.CONFIG_FILE):
            try:
                with open(config.CONFIG_FILE, 'r') as f:
                    self.all_configs = json.load(f)
            except:
                self.all_configs = {}
        self.project_list = self.all_configs.get("projects", {})

    def _save_local_config(self):
        self.all_configs["projects"] = self.project_list
        try:
            with open(config.CONFIG_FILE, 'w') as f:
                json.dump(self.all_configs, f)
        except:
            pass

    def reset_app_config(self):
        """é‡ç½®æ‰€æœ‰è®¾ç½®"""
        if messagebox.askyesno(self.tr("status_error"), self.tr("msg_confirm_reset")):
            try:
                if os.path.exists(config.CONFIG_FILE):
                    os.remove(config.CONFIG_FILE)
                self.root.quit()
            except Exception as e:
                messagebox.showerror("Error", str(e))

    # === å¤–è§‚é€»è¾‘ ===
    def change_language(self):
        self.all_configs["language"] = self.lang_var.get()
        self._save_local_config()
        self._rebuild_ui()

    def change_theme(self):
        self.all_configs["theme"] = self.theme_var.get()
        self._save_local_config()
        self._apply_theme()

    def _apply_theme(self):
        style = ttk.Style()
        style.theme_use('clam')

        mode = self.theme_var.get()
        is_dark = False

        if mode == "dark":
            is_dark = True
        elif mode == "system":
            # ç®€æ˜“ç³»ç»Ÿä¸»é¢˜æ£€æµ‹ (ä»… Windows)
            if os.name == 'nt':
                try:
                    import winreg
                    registry = winreg.ConnectRegistry(None, winreg.HKEY_CURRENT_USER)
                    key = winreg.OpenKey(registry, r'SOFTWARE\Microsoft\Windows\CurrentVersion\Themes\Personalize')
                    val, _ = winreg.QueryValueEx(key, 'AppsUseLightTheme')
                    is_dark = (val == 0)
                except:
                    pass

        # è°ƒç”¨ utils é‡Œçš„è·¨å¹³å°å®‰å…¨å‡½æ•°
        utils.apply_windows_dark_mode(self.root, is_dark)

        # è®¾ç½®é¢œè‰²
        if is_dark:
            bg, fg, field, sel = "#2d2d2d", "#ffffff", "#3d3d3d", "#0078d7"
            self.root.configure(bg=bg)
            style.configure(".", background=bg, foreground=fg, fieldbackground=field)
            style.configure("Treeview", background=field, foreground=fg, fieldbackground=field)
            style.map("Treeview", background=[('selected', sel)], foreground=[('selected', 'white')])
            style.configure("TCombobox", fieldbackground=field, background=bg, foreground=fg, arrowcolor="white")
            style.map("TCombobox", fieldbackground=[('readonly', field)], selectbackground=[('readonly', sel)],
                      selectforeground=[('readonly', 'white')])
        else:
            bg, fg, field = "#f0f0f0", "#000000", "#ffffff"
            self.root.configure(bg=bg)
            style.configure(".", background=bg, foreground=fg, fieldbackground=field)
            style.configure("Treeview", background="white", foreground="black", fieldbackground="white")
            style.map("Treeview", background=[('selected', '#0078d7')], foreground=[('selected', 'white')])
            style.configure("TCombobox", fieldbackground="white", background="white", foreground="black",
                            arrowcolor="black")
            style.map("TCombobox", fieldbackground=[('readonly', 'white')], selectbackground=[('readonly', '#0078d7')],
                      selectforeground=[('readonly', 'white')])

    # === UI æ„å»º ===
    def _rebuild_ui(self):
        curr_proj = self.name_var.get()
        for widget in self.root.winfo_children():
            if not isinstance(widget, tk.Menu): widget.destroy()

        self.root.title(self.tr("app_title"))
        self._build_ui()
        self._apply_theme()

        self._refresh_project_combo()
        if curr_proj in self.project_list:
            self.project_combo.set(curr_proj)

        if self.path_var.get():
            self.refresh_tree_structure(keep_state=True)

    def _build_ui(self):
        menubar = tk.Menu(self.root)
        self.root.config(menu=menubar)

        # Project Menu
        proj_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label=self.tr("menu_project"), menu=proj_menu)
        proj_menu.add_command(label=self.tr("cmd_add_save"), command=self.save_local_project_info)
        proj_menu.add_command(label=self.tr("cmd_delete_local"), command=self.delete_local_project)
        proj_menu.add_separator()
        proj_menu.add_command(label=self.tr("cmd_clear_cloud"), command=self.clear_cloud_data)
        proj_menu.add_separator()
        proj_menu.add_command(label=self.tr("cmd_reset_config"), command=self.reset_app_config)
        proj_menu.add_command(label=self.tr("cmd_exit"), command=self.root.quit)

        # Edit Menu
        edit_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label=self.tr("menu_edit"), menu=edit_menu)
        edit_menu.add_command(label=self.tr("cmd_sel_all"), command=lambda: self.set_all_state(1))
        edit_menu.add_command(label=self.tr("cmd_desel_all"), command=lambda: self.set_all_state(0))
        edit_menu.add_separator()
        edit_menu.add_command(label=self.tr("cmd_check_high"), command=lambda: self.batch_set_state(1))
        edit_menu.add_command(label=self.tr("cmd_uncheck_high"), command=lambda: self.batch_set_state(0))

        # View Menu
        view_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label=self.tr("menu_view"), menu=view_menu)

        theme_menu = tk.Menu(view_menu, tearoff=0)
        view_menu.add_cascade(label=self.tr("submenu_theme"), menu=theme_menu)
        theme_menu.add_radiobutton(label=self.tr("theme_system"), variable=self.theme_var, value="system",
                                   command=self.change_theme)
        theme_menu.add_radiobutton(label=self.tr("theme_light"), variable=self.theme_var, value="light",
                                   command=self.change_theme)
        theme_menu.add_radiobutton(label=self.tr("theme_dark"), variable=self.theme_var, value="dark",
                                   command=self.change_theme)

        lang_menu = tk.Menu(view_menu, tearoff=0)
        view_menu.add_cascade(label=self.tr("submenu_lang"), menu=lang_menu)
        lang_menu.add_radiobutton(label="English", variable=self.lang_var, value="en", command=self.change_language)
        lang_menu.add_radiobutton(label="ä¸­æ–‡", variable=self.lang_var, value="zh", command=self.change_language)

        # Info Frame
        info_frame = ttk.LabelFrame(self.root, text=self.tr("lbl_curr_proj"))
        info_frame.pack(fill="x", padx=10, pady=5)

        r1 = ttk.Frame(info_frame)
        r1.pack(fill="x", pady=5, padx=5)
        self.project_combo = ttk.Combobox(r1, state="readonly", width=20)
        self.project_combo.pack(side="left")
        self.project_combo.bind("<<ComboboxSelected>>", self.switch_project)

        ttk.Label(r1, text=" | ").pack(side="left")
        ttk.Label(r1, text=self.tr("lbl_proj_name")).pack(side="left")
        ttk.Entry(r1, textvariable=self.name_var, width=15).pack(side="left", padx=5)
        ttk.Label(r1, text=self.tr("lbl_url")).pack(side="left")
        ttk.Entry(r1, textvariable=self.url_var, width=25).pack(side="left", padx=5)
        ttk.Button(r1, text="ğŸ”—", command=self.copy_url, width=3).pack(side="left", padx=2)
        ttk.Button(r1, text="ğŸŒ", command=self.open_url, width=3).pack(side="left", padx=2)

        r2 = ttk.Frame(info_frame)
        r2.pack(fill="x", pady=5, padx=5)
        ttk.Label(r2, text=self.tr("lbl_path")).pack(side="left")
        ttk.Entry(r2, textvariable=self.path_var).pack(side="left", fill="x", expand=True, padx=5)
        ttk.Button(r2, text=self.tr("btn_browse"), command=self.select_folder).pack(side="left")

        # Toolbar
        tool_frame = ttk.Frame(self.root)
        tool_frame.pack(fill="x", padx=10, pady=2)
        ttk.Button(tool_frame, text=self.tr("btn_pull"), command=self.pull_cloud_config).pack(side="left")

        ttk.Label(tool_frame, text=self.tr("lbl_sort")).pack(side="right", padx=5)
        self.sort_btn = ttk.Button(tool_frame, text="â¬‡", width=3, command=self.toggle_sort_dir)
        self.sort_btn.pack(side="right")
        sort_cb = ttk.Combobox(tool_frame, textvariable=self.sort_mode, state="readonly", width=8)
        sort_cb['values'] = ("name", "time", "type")
        sort_cb.pack(side="right", padx=2)
        sort_cb.bind("<<ComboboxSelected>>", self.on_sort_change)

        # Treeview
        tree_frame = ttk.Frame(self.root)
        tree_frame.pack(fill="both", expand=True, padx=10, pady=5)

        self.tree = ttk.Treeview(tree_frame, columns=("status"), selectmode="extended")

        self.tree.column("#0", width=600, minwidth=150, anchor="w", stretch=True)
        self.tree.heading("#0", text=self.tr("col_file"))

        self.tree.column("status", width=80, minwidth=60, anchor="center", stretch=False)
        self.tree.heading("status", text=self.tr("col_check"))

        self.tree.pack(side="left", fill="both", expand=True)
        sb = ttk.Scrollbar(tree_frame, orient="vertical", command=self.tree.yview)
        sb.pack(side="right", fill="y")
        self.tree.configure(yscrollcommand=sb.set)
        self.tree.bind("<Button-1>", self.on_click)

        # Bottom
        b_frame = ttk.Frame(self.root)
        b_frame.pack(fill="x", padx=10, pady=10)
        self.status_lbl = ttk.Label(b_frame, text=self.tr("status_ready"))
        self.status_lbl.pack(side="left")
        ttk.Button(b_frame, text=self.tr("btn_sync"), command=self.sync_logic).pack(side="right")

    # === Tree & Logic ===
    def refresh_tree_structure(self, keep_state=False):
        current_selections = set()
        if keep_state:
            root_abs = self.path_var.get()
            for uid, d in self.node_data.items():
                if d['type'] == 'file' and d['state'] == 1:
                    try:
                        current_selections.add(os.path.relpath(d['path'], root_abs))
                    except:
                        pass

        self.tree.delete(*self.tree.get_children())
        self.node_data = {}
        root = self.path_var.get()
        if not root or not os.path.exists(root): return

        # ä½¿ç”¨ logic æ¨¡å—åŠ è½½ ignore
        self.gitignore_patterns = logic.load_gitignore(root, config.DEFAULT_IGNORE)
        self._populate(root, "", current_selections)
        self._recalc_folder_states()

    def _populate(self, current_path, parent_uid, selections):
        # ä½¿ç”¨ logic æ¨¡å—æ’åº
        items = logic.get_sorted_items(current_path, self.sort_mode.get(), self.sort_desc.get())
        root_abs = self.path_var.get()

        for item in items:
            full = os.path.join(current_path, item)
            rel = os.path.relpath(full, root_abs)

            # ä½¿ç”¨ logic æ¨¡å—æ£€æŸ¥ ignore
            if logic.is_ignored(item, rel, self.gitignore_patterns):
                continue

            is_dir = os.path.isdir(full)
            ext = os.path.splitext(item)[1].lower()
            is_bin = ext in config.BINARY_EXTS

            node_type = "dir" if is_dir else ("binary" if is_bin else "file")
            state = 0
            if node_type == 'file' and rel in selections: state = 1

            status_text = self._get_status_icon(state, node_type)
            uid = self.tree.insert(parent_uid, "end", text=f" {item}", values=(status_text,), open=False)
            self.node_data[uid] = {"path": full, "type": node_type, "state": state, "name": item}

            if node_type == 'dir': self._populate(full, uid, selections)

    def _get_status_icon(self, state, ntype):
        if ntype == 'binary': return ICON_BIN
        if state == 1: return ICON_CHECKED
        if state == 2: return ICON_PARTIAL
        return ICON_UNCHECKED

    def on_click(self, event):
        col_id = self.tree.identify_column(event.x)
        item_id = self.tree.identify_row(event.y)
        if not item_id: return
        data = self.node_data.get(item_id)
        if not data or data["type"] == "binary": return
        if col_id == "#1":
            new_state = 0 if data["state"] == 1 else 1
            self.set_item_state(item_id, new_state)
            return "break"

    def set_item_state(self, uid, state):
        d = self.node_data[uid]
        d['state'] = state
        self.tree.item(uid, values=(self._get_status_icon(state, d['type']),))
        if d['type'] == 'dir':
            for c in self.tree.get_children(uid): self._set_down(c, state)
        p = self.tree.parent(uid)
        while p: self._update_parent(p); p = self.tree.parent(p)

    def _set_down(self, uid, state):
        d = self.node_data[uid]
        if d['type'] == 'binary': return
        d['state'] = state
        self.tree.item(uid, values=(self._get_status_icon(state, d['type']),))
        if d['type'] == 'dir':
            for c in self.tree.get_children(uid): self._set_down(c, state)

    def _update_parent(self, uid):
        chs = self.tree.get_children(uid)
        has_1, has_0, has_2 = False, False, False
        for c in chs:
            cd = self.node_data[c]
            if cd['type'] == 'binary': continue
            if cd['state'] == 1:
                has_1 = True
            elif cd['state'] == 0:
                has_0 = True
            elif cd['state'] == 2:
                has_2 = True
        ns = 2 if has_2 or (has_1 and has_0) else (1 if has_1 else 0)
        d = self.node_data[uid]
        if d['state'] != ns:
            d['state'] = ns
            self.tree.item(uid, values=(self._get_status_icon(ns, d['type']),))

    def _recalc_folder_states(self):
        for uid, d in self.node_data.items():
            if d['type'] == 'file' and d['state'] == 1:
                p = self.tree.parent(uid)
                while p: self._update_parent(p); p = self.tree.parent(p)

    def batch_set_state(self, state):
        for uid in self.tree.selection():
            if uid in self.node_data: self.set_item_state(uid, state)

    def set_all_state(self, s):
        for item in self.tree.get_children(""): self._set_down(item, s)

    def toggle_sort_dir(self):
        self.sort_desc.set(not self.sort_desc.get())
        self.sort_btn.config(text="â¬†" if self.sort_desc.get() else "â¬‡")
        self.refresh_tree_structure(keep_state=True)

    def on_sort_change(self, e):
        self.refresh_tree_structure(keep_state=True)

    def select_folder(self):
        p = filedialog.askdirectory()
        if p: self.path_var.set(p); self.refresh_tree_structure()

    def _refresh_project_combo(self):
        self.project_combo['values'] = list(self.project_list.keys())

    def save_local_project_info(self):
        n, p = self.name_var.get().strip(), self.path_var.get()
        if n and p:
            self.project_list[n] = {"url": self.url_var.get(), "path": p}
            self.all_configs["last_active"] = n
            self._save_local_config();
            self._refresh_project_combo();
            self.project_combo.set(n)
            self.status_lbl.config(text=self.tr("msg_saved"))

    def delete_local_project(self):
        n = self.project_combo.get()
        if n in self.project_list:
            if messagebox.askyesno(self.tr("status_error"), self.tr("msg_confirm_del").format(n)):
                del self.project_list[n]
                self.name_var.set("");
                self.path_var.set("");
                self.tree.delete(*self.tree.get_children())
                self._save_local_config();
                self._refresh_project_combo();
                self.project_combo.set("")

    def switch_project(self, e):
        n = self.project_combo.get()
        if n in self.project_list:
            c = self.project_list[n]
            self.name_var.set(n);
            self.url_var.set(c.get("url", ""));
            self.path_var.set(c.get("path", ""))
            self.refresh_tree_structure();
            self.pull_cloud_config()
            self.all_configs["last_active"] = n;
            self._save_local_config()

    def copy_url(self):
        self.root.clipboard_clear(); self.root.clipboard_append(f"{self.url_var.get()}/{self.name_var.get()}")

    def open_url(self):
        webbrowser.open(f"{self.url_var.get()}/{self.name_var.get()}")

    def pull_cloud_config(self):
        u, n = self.url_var.get().strip().rstrip("/"), self.name_var.get().strip()
        if not u or not n: return
        self.status_lbl.config(text=self.tr("status_pulling"), foreground="blue");
        self.root.update()
        try:
            r = requests.get(f"{u}/config/{n}", timeout=3)
            if r.status_code == 200:
                s = set(r.json())
                root = self.path_var.get()
                for uid, d in self.node_data.items():
                    if d['type'] == 'file':
                        rel = os.path.relpath(d['path'], root).replace("\\", "/")
                        d['state'] = 1 if (rel in s or rel.replace("/", "\\") in s) else 0
                        self.tree.item(uid, values=(self._get_status_icon(d['state'], 'file'),))
                self._recalc_folder_states()
                self.status_lbl.config(text=self.tr("status_restored"), foreground="green")
            else:
                self.status_lbl.config(text="No Cloud Config", foreground="orange")
        except:
            pass

    def sync_logic(self):
        self.save_local_project_info()
        url, name, root = self.url_var.get().strip().rstrip("/"), self.name_var.get().strip(), self.path_var.get()
        if not url or not name: return
        self.status_lbl.config(text=self.tr("status_packing"), foreground="blue");
        self.root.update()
        try:
            out = [f"# Project: {name}\n## Structure\n"]
            sel_list = []

            def walk(parent_uid, pre=""):
                children = self.tree.get_children(parent_uid)
                vis_children = [c for c in children if self.node_data[c]['type'] != 'binary']
                cnt = len(vis_children)
                for i, uid in enumerate(vis_children):
                    d = self.node_data[uid]
                    is_last = (i == cnt - 1)
                    marker = "â””â”€" if is_last else "â”œâ”€"
                    mark = "[x]" if d['state'] == 1 else "[ ]"
                    if d['state'] == 2: mark = "[-]"
                    out.append(f"{pre}{marker} {mark} {d['name']}")
                    walk(uid, pre + ("   " if is_last else "â”‚  "))

            walk("")
            out.append("\n" + "=" * 40 + "\n## Contents\n")

            def walk_c(items):
                for uid in items:
                    d = self.node_data[uid]
                    if d['type'] == 'file' and d['state'] == 1:
                        rel = os.path.relpath(d['path'], root).replace("\\", "/")
                        sel_list.append(rel)
                        out.append(f"\n--- START: {rel} ---\n")
                        try:
                            with open(d['path'], 'r', encoding='utf-8', errors='ignore') as f:
                                out.append(f.read())
                        except:
                            out.append("[Err]")
                        out.append(f"\n--- END: {rel} ---\n")
                    if d['type'] == 'dir': walk_c(self.tree.get_children(uid))

            walk_c(self.tree.get_children(""))
            payload = "\n".join(out)
            requests.post(f"{url}/config/{name}", json=sel_list)
            lh = hashlib.md5(payload.encode('utf-8')).hexdigest()
            need = True
            try:
                r = requests.get(f"{url}/hash/{name}", timeout=3)
                if r.status_code == 200 and r.json().get("hash") == lh: need = False
            except:
                pass
            if need:
                self.status_lbl.config(text=self.tr("status_uploading"), foreground="orange");
                self.root.update()
                requests.post(f"{url}/upload/{name}", data=payload.encode('utf-8'),
                              headers={'Content-Type': 'text/plain; charset=utf-8'})
                self.status_lbl.config(text=self.tr("status_done"), foreground="green")
            else:
                self.status_lbl.config(text=self.tr("status_done"), foreground="green")
        except Exception as e:
            self.status_lbl.config(text=self.tr("status_error"), foreground="red")
            messagebox.showerror(self.tr("status_error"), str(e))

    def clear_cloud_data(self):
        u, n = self.url_var.get().strip().rstrip("/"), self.name_var.get().strip()
        if not u or not n: return
        if messagebox.askyesno(self.tr("status_error"), self.tr("msg_confirm_clear").format(n)):
            try:
                requests.delete(f"{u}/project/{n}")
            except:
                pass
            messagebox.showinfo(self.tr("status_done"), self.tr("msg_done"))

--- END: src/gui.py ---


--- START: src/logic.py ---

import os
import fnmatch


def load_gitignore(root_path, default_ignore):
    """è¯»å– .gitignore å¹¶åˆå¹¶é»˜è®¤å¿½ç•¥åˆ—è¡¨"""
    patterns = set(default_ignore)
    git_file = os.path.join(root_path, ".gitignore")
    if os.path.exists(git_file):
        try:
            with open(git_file, 'r', encoding='utf-8') as f:
                for line in f:
                    line = line.strip()
                    if line and not line.startswith('#'):
                        patterns.add(line.rstrip('/'))
        except:
            pass
    return list(patterns)


def is_ignored(filename, rel_path, patterns):
    """åˆ¤æ–­æ–‡ä»¶æ˜¯å¦è¢«å¿½ç•¥"""
    # 1. ç²¾ç¡®åŒ¹é…æ–‡ä»¶å
    if filename in patterns: return True
    # 2. é€šé…ç¬¦åŒ¹é…
    for p in patterns:
        if fnmatch.fnmatch(filename, p): return True
        # 3. è·¯å¾„ç‰‡æ®µåŒ¹é… (ä¾‹å¦‚ node_modules)
        if p in rel_path.split(os.sep): return True
    return False


def get_sorted_items(path, sort_mode, reverse):
    """è·å–æ’åºåçš„æ–‡ä»¶åˆ—è¡¨"""
    try:
        items = os.listdir(path)
    except:
        return []

    f_objs = []
    for item in items:
        full = os.path.join(path, item)
        is_dir = os.path.isdir(full)
        mtime = 0
        ext = os.path.splitext(item)[1].lower()

        if sort_mode == 'time':
            try:
                mtime = os.stat(full).st_mtime
            except:
                pass

        f_objs.append({
            'name': item,
            'd': is_dir,
            't': mtime,
            'e': ext
        })

    if sort_mode == 'name':
        # æ–‡ä»¶å¤¹åœ¨å‰
        f_objs.sort(key=lambda x: (not x['d'], x['name'].lower()), reverse=reverse)
    elif sort_mode == 'time':
        f_objs.sort(key=lambda x: x['t'], reverse=reverse)
    elif sort_mode == 'type':
        f_objs.sort(key=lambda x: (x['e'], x['name'].lower()), reverse=reverse)

    return [x['name'] for x in f_objs]

--- END: src/logic.py ---


--- START: src/main.py ---

import sys
import os
import tkinter as tk
import tkinter.messagebox  # æ˜¾å¼å¯¼å…¥


# === æ ¸å¿ƒè·¯å¾„ä¿®å¤ ===
def setup_path():
    """å¼ºåˆ¶å°†å½“å‰è¿è¡Œç›®å½•åŠ å…¥ç³»ç»Ÿè·¯å¾„"""
    if getattr(sys, 'frozen', False):
        # å¦‚æœæ˜¯æ‰“åŒ…åçš„ exe (PyInstaller)
        # èµ„æºæ–‡ä»¶ä¼šè¢«è§£å‹åˆ° sys._MEIPASS
        base_path = sys._MEIPASS
    else:
        # å¦‚æœæ˜¯æœ¬åœ°ä»£ç è¿è¡Œ
        base_path = os.path.dirname(os.path.abspath(__file__))

    # å°†è¯¥ç›®å½•æ’å…¥åˆ° sys.path çš„æœ€å‰é¢
    if base_path not in sys.path:
        sys.path.insert(0, base_path)

    return base_path


# 1. å…ˆæ‰§è¡Œè·¯å¾„è®¾ç½®
current_path = setup_path()

# 2. ç„¶åå†å¯¼å…¥åŒçº§æ¨¡å—
try:
    # ç›´æ¥ importï¼Œä¸è¦ç”¨ .gui
    from gui import CodeSyncApp
except ImportError as e:
    # å¦‚æœå‡ºé”™ï¼Œæ˜¾ç¤ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
    root = tk.Tk()
    root.withdraw()
    err_msg = f"å¯åŠ¨é”™è¯¯: {e}\n\nSearch Path:\n{sys.path}\n\nBase Path:\n{current_path}"
    tkinter.messagebox.showerror("Error", err_msg)
    sys.exit(1)


def main():
    root = tk.Tk()
    app = CodeSyncApp(root)
    root.mainloop()


if __name__ == "__main__":
    main()

--- END: src/main.py ---


--- START: src/utils.py ---

import platform
import ctypes


def apply_windows_dark_mode(root, is_dark):
    """
    ä»…åœ¨ Windows ä¸‹å°è¯•ä¿®æ”¹æ ‡é¢˜æ é¢œè‰²ä¸ºæ·±è‰²/æµ…è‰²ã€‚
    Mac/Linux ä¼šè‡ªåŠ¨å¿½ç•¥ã€‚
    """
    if platform.system() != "Windows":
        return

    try:
        # å¼ºåˆ¶åˆ·æ–°çª—å£ä»¥è·å–å¥æŸ„
        root.update()
        hwnd = ctypes.windll.user32.GetParent(root.winfo_id())

        # Windows API å¸¸é‡
        DWMWA_USE_IMMERSIVE_DARK_MODE = 20  # Win11 / Win10 20H1+
        DWMWA_USE_IMMERSIVE_DARK_MODE_OLD = 19  # Win10 æ—§ç‰ˆæœ¬

        # 2 = å¼ºåˆ¶æ·±è‰², 0 = å¼ºåˆ¶æµ…è‰² (æ ¹æ®ä¹‹å‰çš„ç»éªŒå€¼)
        value = ctypes.c_int(2 if is_dark else 0)

        # ä¼˜å…ˆå°è¯•æ–° API
        if ctypes.windll.dwmapi.DwmSetWindowAttribute(hwnd, DWMWA_USE_IMMERSIVE_DARK_MODE, ctypes.byref(value), 4) != 0:
            # å¤±è´¥åˆ™å°è¯•æ—§ API
            ctypes.windll.dwmapi.DwmSetWindowAttribute(hwnd, DWMWA_USE_IMMERSIVE_DARK_MODE_OLD, ctypes.byref(value), 4)
    except Exception:
        pass

--- END: src/utils.py ---


--- START: .gitignore ---

# ==========================
# Python ç¼–è¯‘ä¸ç¼“å­˜
# ==========================
__pycache__/
*.py[cod]
*$py.class

# ==========================
# è™šæ‹Ÿç¯å¢ƒ (Virtual Environments)
# ==========================
# å¸¸è§çš„è™šæ‹Ÿç¯å¢ƒç›®å½•å
venv/
.venv/
env/
.env/
venv.bak/

# ==========================
# PyInstaller æ‰“åŒ…ç”Ÿæˆæ–‡ä»¶
# ==========================
# æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶
build/
# æœ€ç»ˆç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•
dist/
# PyInstaller ç”Ÿæˆçš„ spec æ–‡ä»¶ (å¦‚æœä½ ä¸»è¦é è„šæœ¬æ„å»ºï¼Œè¿™äº›è‡ªåŠ¨ç”Ÿæˆçš„å¯ä»¥å¿½ç•¥)
*.spec

# ==========================
# Inno Setup æ‰“åŒ…ç”Ÿæˆæ–‡ä»¶
# ==========================
# Inno Setup é»˜è®¤çš„è¾“å‡ºç›®å½•
Output/
# ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶
*.tmp

# ==========================
# IDE ä¸ ç¼–è¾‘å™¨é…ç½®
# ==========================
# PyCharm / IntelliJ IDEA
.idea/
# VS Code
.vscode/
# Sublime Text
*.sublime-workspace
*.sublime-project

# ==========================
# æ“ä½œç³»ç»Ÿç”Ÿæˆæ–‡ä»¶
# ==========================
# Windows
Thumbs.db
ehthumbs.db
Desktop.ini
$RECYCLE.BIN/

# macOS
.DS_Store
.AppleDouble
.LSOverride
._*

# Linux
*~

# ==========================
# Docker
# ==========================
# å¦‚æœä½ æœ‰æœ¬åœ°æ˜ å°„çš„æ•°æ®å·ç›®å½•ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¿½ç•¥
server/data/
.dockerignore

# ==========================
# CodeSync é¡¹ç›®ç‰¹å®šæ–‡ä»¶
# ==========================
# 1. æœ¬åœ°é…ç½®æ–‡ä»¶ (å­˜æ”¾äº†ç”¨æˆ·çš„ä¸»é¢˜ã€è¯­è¨€ã€æœ€è¿‘é¡¹ç›®ç­‰éšç§è®¾ç½®ï¼Œä¸åº”ä¸Šä¼ )
codesync_config.json

# 2. ä¹Ÿæ˜¯æœ¬åœ°é…ç½®çš„æ—§ç‰ˆæœ¬åç§° (ä»¥é˜²ä¸‡ä¸€)
config.json

# 3. å¦‚æœæœåŠ¡ç«¯å¯ç”¨äº†æ–‡ä»¶æŒä¹…åŒ–å­˜å‚¨ï¼Œå¿½ç•¥å­˜å‚¨ç›®å½•
server/project_store/
server/hash_cache/

# 4. å¿½ç•¥æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶
*.log

# ==========================
# ä¿æŠ¤æ€§å¿½ç•¥ (é˜²æ­¢è¯¯ä¼ å¯†é’¥ç­‰)
# ==========================
.env
.secrets
key.pem
cert.pem

--- END: .gitignore ---


--- START: requirements.txt ---

requests
darkdetect  # å¯é€‰ï¼Œå¦‚æœä½ æƒ³è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿä¸»é¢˜
pyinstaller # ä»…å¼€å‘ç¯å¢ƒéœ€è¦

--- END: requirements.txt ---


--- START: VERSION ---

1.0.15

--- END: VERSION ---